<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram 图片裁剪</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    <style>
        body { text-align: center; font-family: Arial, sans-serif; }
        #container { max-width: 400px; margin: auto; }
        img { max-width: 100%; }
        .btn { margin-top: 10px; padding: 10px; background: #007bff; color: white; border: none; cursor: pointer; }
        .btn:disabled { background: #ccc; }
    </style>
</head>
<body>
    <h2>裁剪 Telegram 图片</h2>
    <div id="container">
        <img id="image" alt="加载中...">
        <button id="cropBtn" class="btn" disabled>裁剪并下载</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <script>
        // 从 URL 获取 Telegram 图片链接
        const urlParams = new URLSearchParams(window.location.search);
        const telegramImageUrl = urlParams.get('image_url'); // 机器人传来的图片 URL

        const image = document.getElementById('image');
        const cropBtn = document.getElementById('cropBtn');
        let cropper;

        if (telegramImageUrl) {
            fetch(telegramImageUrl)
                .then(response => response.blob())
                .then(blob => {
                    const objectURL = URL.createObjectURL(blob);
                    image.src = objectURL;

                    image.onload = () => {
                        cropper = new Cropper(image, { aspectRatio: 16 / 9 });
                        cropBtn.disabled = false;
                    };
                })
                .catch(error => console.error("图片加载失败", error));
        } else {
            alert("未检测到 Telegram 图片 URL！");
        }

        // 裁剪并下载图片
        cropBtn.addEventListener("click", () => {
            if (!cropper) return;
            const croppedCanvas = cropper.getCroppedCanvas();
            const croppedImageURL = croppedCanvas.toDataURL("image/png");

            const link = document.createElement("a");
            link.href = croppedImageURL;
            link.download = "cropped_image.png";
            link.click();
        });
    </script>
</body>
</html>
